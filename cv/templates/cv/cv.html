{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hoja de Vida</title>

  <!-- Bootstrap (solo grid/utilidades) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Nueva interfaz Azul/Blanco -->
  <link rel="stylesheet" href="{% static 'cv/ui.css' %}">
</head>

<body>
  <div class="bg-live" aria-hidden="true"></div>
  <div class="ui-shell">

    <!-- Topbar -->
  <header class="ui-topbar">

    <div class="ui-topbar-left brand">
      <div class="brand-badge" aria-hidden="true"></div>
      <div>
        <div class="brand-title">CV ¬∞ Vitae</div>
      </div>
    </div>

    <div class="ui-topbar-center">
      <a class="btn-neo btn-neo--ghost" href="{% url 'garage_list' %}">
        <span class="ico">üõçÔ∏è</span> Garage
      </a>
    </div>

    <div class="ui-topbar-right">
      <a class="btn-neo btn-neo--ghost" href="{% url 'admin:index' %}" target="_blank" rel="noreferrer">
        <span class="ico">üõ†Ô∏è</span> Administrador
      </a>
    </div>

  </header>


    <main class="ui-grid">

      <!-- Perfil -->
      <section class="card">
        <div class="card-inner">

          {% if perfil %}
          <div class="profile profile-vertical">
            <div class="avatar avatar-lg">
              {% if perfil.fotoperfil %}
                <img src="{{ perfil.fotoperfil.url }}" alt="Foto de perfil">
              {% else %}
                <div class="avatar-placeholder">CV</div>
              {% endif %}
            </div>

            <div class="profile-text">
              <p class="profile-name mb-0">{{ perfil.nombres }} {{ perfil.apellidos }}</p>
              <p class="profile-desc">{{ perfil.descripcionperfil }}</p>

              <div class="d-flex gap-2 flex-wrap justify-content-center">
                <span class="tag">C√©dula: {{ perfil.numerocedula }}</span>
                <span class="tag">{{ perfil.nacionalidad }}</span>
              </div>
            </div>
          </div>
            
            <!-- Datos personales (tarjetas) -->
            <div class="personal-grid">

              {% if perfil.lugarnacimiento %}
              <div class="personal-item">
                <strong>Lugar de nacimiento</strong>
                <span>{{ perfil.lugarnacimiento }}</span>
              </div>
              {% endif %}

              {% if perfil.fechanacimiento %}
              <div class="personal-item">
                <strong>Fecha de nacimiento</strong>
                <span>{{ perfil.fechanacimiento|date:"d/m/Y" }}</span>
              </div>
              {% endif %}

              {% if perfil.sexo %}
              <div class="personal-item">
                <strong>Sexo</strong>
                <span>{{ perfil.get_sexo_display }}</span>
              </div>
              {% endif %}

              {% if perfil.estadocivil %}
              <div class="personal-item">
                <strong>Estado civil</strong>
                <span>{{ perfil.estadocivil }}</span>
              </div>
              {% endif %}

              {% if perfil.licenciaconducir %}
              <div class="personal-item">
                <strong>Licencia de conducir</strong>
                <span>{{ perfil.licenciaconducir }}</span>
              </div>
              {% endif %}

              {% if perfil.telefonoconvencional %}
              <div class="personal-item">
                <strong>Tel√©fono convencional</strong>
                <span>{{ perfil.telefonoconvencional }}</span>
              </div>
              {% endif %}

              {% if perfil.telefonofijo %}
              <div class="personal-item">
                <strong>Tel√©fono</strong>
                <span>{{ perfil.telefonofijo }}</span>
              </div>
              {% endif %}

              {% if perfil.direcciondomiciliaria %}
              <div class="personal-item">
                <strong>Direcci√≥n</strong>
                <span>{{ perfil.direcciondomiciliaria }}</span>
              </div>
              {% endif %}

              {% if perfil.direcciontrabajo %}
              <div class="personal-item">
                <strong>Direcci√≥n de trabajo</strong>
                <span>{{ perfil.direcciontrabajo }}</span>
              </div>
              {% endif %}

              {% if perfil.sitioweb %}
              <div class="personal-item">
                <strong>Sitio web</strong>
                <a href="{{ perfil.sitioweb }}" target="_blank" rel="noreferrer">
                  {{ perfil.sitioweb }}
                </a>
              </div>
              {% endif %}

            </div>

          {% else %}
          <h3 class="section-title">Sin perfil activo <span class="pill">0 datos</span></h3>

          <div class="empty-state mt-2">
            <div class="empty-head">
              <div class="empty-ico">üë§</div>
              <div style="min-width:0">
                <p class="empty-title mb-1">Primero crea tu perfil</p>
                <p class="empty-text mb-0">
                 Para que el CV se llene, necesitas registrar tus datos en el editor.
                </p>
              </div>
            </div>

            <div class="empty-actions mt-3">
              <a class="btn-neo btn-neo--primary" href="{% url 'editar_perfil' %}">
                <span class="ico">‚ûï</span>
                Crear perfil
              </a>

              <a class="btn-neo btn-neo--ghost" href="{% url 'admin:index' %}" target="_blank" rel="noreferrer">
                <span class="ico">üõ†Ô∏è</span>
                Admin
              </a>
            </div>

            <p class="sidebar-note mt-3 mb-0">
              Tip: si te pide login, usa el usuario admin creado en Django.
            </p>
          </div>
          {% endif %}
        </div>
      </section>

      <!-- Contenido principal -->
      <section class="card">
        <div class="card-inner">

          <div class="d-flex align-items-center justify-content-between gap-2 flex-wrap mb-2">
            <h2 class="section-title mb-0">Contenido del CV</h2>
            <span class="pill">Secciones</span>
          </div>

          <!-- Experiencia -->
          <div class="mt-3">
            <div class="d-flex align-items-center justify-content-between">
              <h3 class="section-title topic-title">
                <span class="topic-ico">üíº</span>
                Experiencia laboral
              </h3>

              <span class="pill">{% if experiencia %}{{ experiencia|length }}{% else %}0{% endif %}</span>
            </div>

            <div class="timeline mt-2">
              {% if experiencia %}
                {% for e in experiencia %}
                  <article class="item">
                    <p class="item-title">{{ e.cargodesempenado }}</p>
                    <p class="item-sub">{{ e.nombrempresa }}</p>
                    <p class="item-text">{{ e.descripcionfunciones }}</p>
                  </article>
                {% endfor %}
              {% else %}
                <div class="item">
                  <p class="item-title mb-0">Sin experiencia registrada</p>
                  <p class="item-sub mb-0">Agrega tu experiencia desde el panel de edici√≥n.</p>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Cursos -->
          <div class="mt-4">
            <div class="d-flex align-items-center justify-content-between">
              <h3 class="section-title topic-title">
                <span class="topic-ico">üéì</span>
                Cursos realizados
              </h3>
              <span class="pill">{% if cursos %}{{ cursos|length }}{% else %}0{% endif %}</span>
            </div>

            <div class="timeline mt-2">
              {% if cursos %}
                {% for c in cursos %}
                  <article class="item">
                    <p class="item-title">{{ c.nombrecurso }}</p>
                    <p class="item-sub">{{ c.totalhoras }} horas</p>
                    <p class="item-text">{{ c.descripcioncurso }}</p>

                    <div class="item-actions">
                      {% if c.rutacertificado %}
                        <a class="btn-neo btn-neo--ghost" target="_blank" rel="noreferrer" href="{{ c.rutacertificado.url }}">
                          <span class="ico">üìé</span>
                          Certificado
                        </a>
                      {% endif %}
                    </div>
                  </article>
                {% endfor %}
              {% else %}
                <div class="item">
                  <p class="item-title mb-0">Sin cursos registrados</p>
                  <p class="item-sub mb-0">Puedes a√±adir cursos y certificados.</p>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Reconocimientos -->
          <div class="mt-4">
            <div class="d-flex align-items-center justify-content-between">
              <h3 class="section-title topic-title">
                <span class="topic-ico">üèÖ</span>
                Reconocimientos
              </h3>
              <span class="pill">{% if reconocimientos %}{{ reconocimientos|length }}{% else %}0{% endif %}</span>
            </div>

            <div class="timeline mt-2">
              {% if reconocimientos %}
                {% for r in reconocimientos %}
                  <article class="item">

                    <p class="item-title">
                      {{ r.tiporeconocimiento }} - {{ r.descripcionreconocimiento }}
                    </p>

                    <p class="item-sub">
                      {{ r.fechareconocimiento|date:"d/m/Y" }}
                    </p>

                    <p class="item-text">
                      {{ r.entidadpatrocinadora }}
                    </p>

                    <div class="item-actions">
                      {% if r.rutacertificado %}
                        <a class="btn-neo btn-neo--ghost" target="_blank" rel="noreferrer" href="{{ r.rutacertificado.url }}">
                          <span class="ico">üìé</span>
                          Ver reconocimiento
                        </a>
                      {% endif %}
                    </div>

                  </article>
                {% endfor %}
              {% else %}
                <div class="item">
                  <p class="item-title mb-0">Sin reconocimientos</p>
                  <p class="item-sub mb-0">Cuando tengas, se mostrar√°n aqu√≠.</p>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Productos acad√©micos / laborales -->
          <div class="mt-4">
            <div class="d-flex align-items-center justify-content-between">
              <h3 class="section-title topic-title">
                <span class="topic-ico">üß©</span>
                Productos
              </h3>
              <span class="pill">
                {% if productos_academicos %}{{ productos_academicos|length }}{% else %}0{% endif %}
                /
                {% if productos_laborales %}{{ productos_laborales|length }}{% else %}0{% endif %}
              </span>
            </div>

            <div class="timeline mt-2">
              {% if productos_academicos %}
                <div class="group-head">
                  <span class="group-dot group-dot--blue"></span>
                  <span class="group-title">Acad√©micos</span>
                </div>

                {% for p in productos_academicos %}
                  <article class="item">
                    <p class="item-title mb-1">{{ p.titulo }}</p>
                    <p class="item-text mb-3">{{ p.descripcion }}</p>

                    {% if p.certificado %}
                      <a class="btn-neo btn-neo--ghost" target="_blank" rel="noreferrer" href="{{ p.certificado.url }}">
                        üìé Ver certificado
                      </a>
                    {% elif p.rutacertificado %}
                      <a class="btn-neo btn-neo--ghost" target="_blank" rel="noreferrer" href="{{ p.rutacertificado.url }}">
                        üìé Ver certificado
                      </a>
                    {% endif %}
                  </article>
                {% endfor %}
              {% endif %}


              {% if productos_laborales %}
                <div class="group-head mt-3">
                  <span class="group-dot group-dot--green"></span>
                  <span class="group-title">Laborales</span>
                </div>

                {% for p in productos_laborales %}
                  <article class="item">
                    <p class="item-title mb-1">{{ p.titulo }}</p>
                    <p class="item-text mb-3">{{ p.descripcion }}</p>

                    {% if p.certificado %}
                      <a class="tag" target="_blank" rel="noreferrer" href="{{ p.certificado.url }}">
                        üìé Ver certificado
                      </a>
                    {% elif p.rutacertificado %}
                      <a class="tag" target="_blank" rel="noreferrer" href="{{ p.rutacertificado.url }}">
                        üìé Ver certificado
                      </a>
                    {% endif %}
                  </article>
                {% endfor %}
              {% endif %}


              {% if not productos_academicos and not productos_laborales %}
                <div class="item">
                  <p class="item-title mb-0">Sin productos registrados</p>
                  <p class="item-sub mb-0">Acad√©micos o laborales (art√≠culos, proyectos, etc.).</p>
                </div>
              {% endif %}
            </div>
          </div>

        </div>
      </section>

      <!-- Certificados / anexos -->
      <aside class="card">
        <div class="card-inner">
          <div class="d-flex align-items-center justify-content-between">
            <h3 class="section-title">PDF ¬∑ Selecci√≥n</h3>
            <span class="pill">Personalizable</span>
          </div>

          <p class="sidebar-note mt-2 mb-3">
            Marca qu√© secciones y anexos quieres incluir.
          </p>

          <div class="item">
            <p class="item-title mb-2">Secciones</p>
            <div class="d-flex flex-column gap-2">
              <label><input class="form-check-input me-2 sec" type="checkbox" value="perfil" checked> Perfil</label>
              <label><input class="form-check-input me-2 sec" type="checkbox" value="experiencia" checked> Experiencia</label>
              <label><input class="form-check-input me-2 sec" type="checkbox" value="cursos" checked> Cursos</label>
              <label><input class="form-check-input me-2 sec" type="checkbox" value="reconocimientos" checked> Reconocimientos</label>
              <label><input class="form-check-input me-2 sec" type="checkbox" value="productos_academicos" checked> Productos acad√©micos</label>
              <label><input class="form-check-input me-2 sec" type="checkbox" value="productos_laborales" checked> Productos laborales</label>
              <label><input class="form-check-input me-2 sec" type="checkbox" value="garage" checked> Garage</label>
            </div>
          </div>

          <div class="mt-3 item">
            <div class="d-flex align-items-center justify-content-between">
              <p class="item-title mb-0">Anexos (certificados)</p>
              <span class="pill">{% if certificados %}{{ certificados|length }}{% else %}0{% endif %}</span>
            </div>

            <div class="cert-list mt-3">
              {% if certificados %}
                {% for c in certificados %}
                  <label class="cert" style="cursor:pointer;">
                    <div class="cert-meta">
                      <p class="cert-name">#{{ forloop.counter }} ¬∑ {{ c.nombre }}</p>
                      <p class="cert-type">{{ c.tipo }}{% if c.fecha %} ¬∑ {{ c.fecha }}{% endif %}</p>
                    </div>
                    <input class="form-check-input cert" type="checkbox" value="{{ c.value }}" checked>
                  </label>
                {% endfor %}
              {% else %}
                <div class="item">
                  <p class="item-title mb-0">Todav√≠a no hay anexos</p>
                  <p class="item-sub mb-0">Cuando subas certificados, aparecer√°n aqu√≠.</p>
                </div>
              {% endif %}
            </div>
          </div>

          <div class="mt-3">
            <button class="btn-neo btn-neo--primary w-100 justify-content-center" type="button" onclick="generarPDF()">
              <span class="ico">üßæ</span>
              Generar PDF con lo seleccionado
          </div>
        </div>
      </aside>

    </main>
  </div>

  <script src="{% static 'cv/ui.js' %}"></script>

  <script>
  function generarPDF(){
    let params = [];
    document.querySelectorAll(".sec:checked").forEach(chk => {
      params.push("sec=" + encodeURIComponent(chk.value));
    });
    document.querySelectorAll(".cert:checked").forEach(chk => {
      params.push("cert=" + encodeURIComponent(chk.value));
    });
    window.open("{% url 'cv_pdf' %}?" + params.join("&"), "_blank");
  }
  </script>

  <script>
    (function () {
      const el = document.querySelector('.bg-live');
      if (!el) return;

      let t = 0;
      function loop(){
        t += 0.012; // velocidad
        const x = Math.sin(t) * 40;   // movimiento horizontal
        const y = Math.cos(t * 0.8) * 30; // movimiento vertical
        const s = 1 + (Math.sin(t * 0.6) * 0.03); // leve zoom
        el.style.transform = `translate3d(${x}px, ${y}px, 0) scale(${s})`;
      requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);
    })();
  </script>

</body>
</html>
